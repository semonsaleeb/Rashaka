<h1 class="mb-4 text-center">الطلبات</h1>

<!-- ✅ حالة التحميل -->
@if (isLoading) {
<div class="text-center">جاري التحميل...</div>
}

<!-- ✅ رسالة الخطأ -->
@if (errorMessage) {
<div class="alert alert-danger text-center">{{ errorMessage }}</div>
}

<!-- ✅ لو فيه طلبات -->
@if (groupedOrders.length > 0) {
<div class="px-3 px-md-5" (touchstart)="onTouchStart($event)" (touchend)="onTouchEnd($event)">
   <ngb-carousel [activeId]="currentIndex.toString()"
              [showNavigationIndicators]="false"
              [showNavigationArrows]="false"
              [keyboard]="true"
              [wrap]="false"
              [pauseOnHover]="false"
              (slide)="onSlide($event)">

        @for (group of groupedOrders; track group; let i = $index) {
        <ng-template ngbSlide [id]="i.toString()">
            <div class="row justify-content-center">
                @for (order of group; track order) {
                <div class="col-12 col-md-4 mb-4"> <!-- 1 product per slide mobile, 3 desktop -->
                    <div class="order-card text-center p-4 rounded shadow-sm">

                        <!-- رقم الطلب + الحالة -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-light text-dark px-3 py-2">#{{ order.order_id }}</span>
                            <span class="status-badge" [ngClass]="{
                      'text-success': order.status === 'تم التسليم',
                      'text-danger': order.status === 'ملغي',
                      'text-warning': order.status === 'قيد التنفيذ',
                      'text-secondary': order.status === 'pending'
                    }">
                                {{ order.status }}
                            </span>
                        </div>

                        <!-- صورة + بيانات المنتج الأول -->
                        @if (order.items?.length > 0) {
                        <div class="product-image-wrapper mb-3">
                            <img [src]="order.items[0].product_images?.length ? encodeUrl(order.items[0].product_images[0]) : 'assets/no-image.png'"
                                alt="{{ order.items[0].product_name }}" class="product-image rounded" width="100"
                                height="100" />
                        </div>
                        <p class="fw-bold">{{ order.items[0].product_name }}</p>
                        <p>الكمية: {{ order.items[0].quantity }}</p>
                        } @else {
                        <p class="text-muted">لا توجد منتجات</p>
                        }

                        <!-- باقي التفاصيل -->
                        <p><strong>المجموع:</strong> {{ order.total_price }} ر.س</p>
                        <p><strong>طريقة الدفع:</strong>
                            <span class="payment-method">{{ order.payment_method }}</span>
                        </p>
                        <p><strong>تاريخ الطلب:</strong> {{ order.created_at | date:'yyyy-MM-dd' }}</p>
                    </div>
                </div>
                }
            </div>
        </ng-template>
        }
    </ngb-carousel>

    <!-- ✅ أزرار التنقل + النقاط -->
    <div class="d-flex justify-content-between align-items-center mt-4 flex-wrap gap-2">

        <!-- النقاط -->
        <div class="d-flex gap-2 justify-content-center justify-content-md-start" dir="ltr">
            @for (group of groupedOrders; track group; let i = $index) {
            <button type="button" class="dot btn btn-sm " [class.active]="i === currentIndex"
                (click)="goToSlide(i)"></button>
            }
        </div>


        <!-- الأسهم -->
        <div class="d-flex gap-2 d-none d-md-flex"> <!-- hide on mobile (sm < 768px), show md+ -->
            <button class="arrow-btn next" (click)="nextSlide()"
                [disabled]="currentIndex === groupedOrders.length - 1"></button>
            <button class="arrow-btn prev" (click)="prevSlide()" [disabled]="currentIndex === 0"></button>
        </div>

    </div>
</div>

} @else if (!isLoading) {
<p class="text-center">لا توجد طلبات بعد.</p>
}