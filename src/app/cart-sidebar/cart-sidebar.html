<div class="offcanvas offcanvas-end" dir="rtl" tabindex="-1" id="cartSidebar" aria-labelledby="cartSidebarLabel"
  data-bs-backdrop="true" data-bs-scroll="true">
  <div class="offcanvas-header">
    <h3 id="cartSidebarLabel" class="fw-bold d-flex fs-6 align-items-center">
      عربة التسوق
      <span class="badge bg-secondary ms-2 px-2 mx-2">
        {{ cartState.cartCount$ | async }}
      </span>
    </h3>
    <div class="px-5 mx-2"></div>

    <div class="offcanvas-header d-flex fs-6 justify-content-between align-items-center ">
      <div class="d-flex align-items-center">
        <h5 class="offcanvas-title fw-semibold fs-6 mb-0 px-3">إلغاء</h5>
      </div>

      <button type="button" class="btn-close px-2" data-bs-dismiss="offcanvas" aria-label="إغلاق"></button>
    </div>

  </div>
  <div class="offcanvas-body">

    <!-- العرض اللي إنتي كتباه -->
    <div class="col-12">
      <h6 class="mb-4 text-end">
        <img src="assets/Images/delivery.svg" class="me-2" style="max-height: 22px;">
        <span> شحن مجاني للطلبات أكثر من </span>
        <strong>1000 ريال</strong>
      </h6>

      <div class="progress border border-c mb-3" style="height: 10px;">
        <div class="progress-bar" role="progressbar" [style.width.%]="progressValue"
          [attr.aria-valuenow]="progressValue" aria-valuemin="0" aria-valuemax="100" style="background-color: #2EA2CC;">
        </div>
      </div>

      @for (item of cartItems; track trackByProductId($index, item)) {
      <div class="card mb-3 shadow-sm border-1 rounded-4 p-2" style="background-color: #FAFAFA;">
        <div class="row g-2 align-items-center">
          <div class="col-3 text-center">
            <div class="col-3 text-center">
              @if (item.images && item.images.length > 0) {
              <img [src]="item.images[0]" class="img-fluid rounded-3" style="max-height: 70px;">
              } @else {
              <img src="assets/Images/placeholder.png" class="img-fluid rounded-3" style="max-height: 70px;">
              }
            </div>
          </div>
          <div class="col-9">
            <div class="card-body mx-lg-3 text-end p-2">
              <h6 class="card-title fw-bold">{{ item.product_name_ar }}</h6>
              <!-- <div class="small">
                @if ((+item.sale_unit_price! > 0) && (+item.sale_unit_price! !== +item.unit_price!)) {
                <span class="fw-bold text-success ms-2">{{ item.sale_unit_price }} ر.س</span>
                <span class="text-muted text-decoration-line-through">{{ item.unit_price }} ر.س</span>
                } @else {
                <span class="fw-bold text-dark">{{ item.unit_price }} ر.س</span>
                }
              </div> -->
              <div class="small">
                <!-- @if ((+item.unit_price_after_offers! > 0) && (+item.unit_price_after_offers! !== +item.price!)) {
    <span class="fw-bold text-success ms-2">
      {{ item.totalPrice }} {{ 'CART.CURRENCY' | translate }}
    </span>
    <span class="text-muted text-decoration-line-through">
      {{ item.total_price_after_offers }} {{ 'CART.CURRENCY' | translate }}
    </span>
  } @else {
    <span class="fw-bold text-dark">
      {{ item.totalPriceAfterOffers }} {{ 'CART.CURRENCY' | translate }}
    </span>
  } -->
                <!-- لو مستخدم مسجل دخول -->
                <ng-container *ngIf="isLoggedIn(); else guestCart">
                  <span class="fw-bold text-success ms-2">
                    {{ item.total_price_after_offers }} {{ 'CART.CURRENCY' | translate }}
                  </span>
                  <span class="text-muted text-decoration-line-through"
                    *ngIf="item.totalPrice !== item.totalPriceAfterOffers">
                    {{ item.totalPrice }} {{ 'CART.CURRENCY' | translate }}
                  </span>
                </ng-container>

                <!-- لو ضيف -->
                <ng-template #guestCart>
                  <span class="fw-bold text-success ms-2">
                    {{ item.unit_price }} {{ 'CART.CURRENCY' | translate }}

                  </span>
                  <span class="text-muted text-decoration-line-through" *ngIf="item.unitPrice !== item.sale_unit_price">
                    {{ item.sale_unit_price }} {{ 'CART.CURRENCY' | translate }}
                  </span>
                </ng-template>


              </div>



              <div class="d-flex align-items-center justify-content-between mt-2">
                <button class="btn btn-outline-danger btn-sm" (click)="removeItem(item.product_id)">
                  <i class="fa-solid fa-trash"></i>
                </button>
                <div class="d-flex align-items-center gap-2 ">
                  <button class="btn btn-outline-secondary btn-sm" (click)="decreaseQuantity(item.product_id)">
                    <i class="fa-solid fa-minus"></i>
                  </button>
                  <span>{{ item.quantity }}</span>
                  <button class="btn btn-outline-secondary btn-sm" (click)="increaseQuantity(item.product_id)">
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- زر الذهاب لعربة التسوق -->
    <a [routerLink]="['/cart']" class="btn btn-success w-100 mt-3" data-bs-dismiss="offcanvas">
      <i class="fa-solid fa-cart-shopping me-2"></i> الذهاب إلى السلة
    </a>




  </div>
</div>